{"version":3,"file":"index.js","sources":["../../../src/manifest/index.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { sync as parent } from 'parentpath';\nimport { path, fs, config, _, t } from 'azk';\nimport { runInNewContext, createScript } from 'vm';\nimport { System } from 'azk/system';\nimport { createSync as createCache } from 'fscache';\nimport { sync as mkdir } from 'mkdirp';\nimport { Validate } from 'azk/manifest/validate';\nimport { ManifestError, ManifestRequiredError, SystemNotFoundError } from 'azk/utils/errors';\nimport Utils from 'azk/utils';\n\nvar file_name = config('manifest');\nvar check     = require('syntax-error');\nvar tsort     = require('gaia-tsort');\n\nvar ManifestDsl = {\n  console: console,\n  require: require,\n  env: process.env,\n  disable: null,\n\n  // Mounts\n  path(folder) {\n    return { type: 'path', value: folder }\n  },\n\n  persistent(name) {\n    return { type: 'persistent', value: name }\n  },\n\n  // Systems\n  system(name, data) {\n    this.addSystem(name, data);\n  },\n\n  systems(systems) {\n    _.each(systems, (system, name) => {\n      this.addSystem(name, system);\n    });\n  },\n\n  // Extra options\n  addImage(name, image) {\n    this.images[name] = image;\n  },\n\n  registerBin(name, ...args) {\n    this.bins[name] = [...args];\n  },\n\n  setDefault(name) {\n    this.default = name;\n  },\n}\n\nclass Meta {\n  constructor(manifest, cache = null) {\n    this.manifest = manifest;\n    this.cache = cache;\n  }\n\n  set cache(value) {\n    this.__cache = value;\n  }\n\n  clean() {\n    var path = this.manifest.cache_dir;\n    if (fs.existsSync(path)) {\n      this.__cache = null;\n      return fs.removeSync(path);\n    }\n  }\n\n  get cache() {\n    if (!this.__cache) {\n      var cache_dir = this.manifest.cache_dir;\n      mkdir(cache_dir);\n      this.__cache = createCache(cache_dir);\n    }\n    return this.__cache;\n  }\n\n  getOrSet(key, defaultValue) {\n    var value = this.cache.getSync(key);\n    if (!value && defaultValue) {\n      value = defaultValue;\n      this.set(key, value);\n    }\n    return value;\n  }\n\n  get(key, defaultValue) {\n    return this.cache.getSync(key) || defaultValue;\n  }\n\n  set(key, value) {\n    this.cache.putSync(key, value);\n    return this;\n  }\n}\n\nexport class Manifest {\n  constructor(cwd, file = null, required = false) {\n    if (typeof file == \"boolean\")\n      [required, file] = [file, null];\n\n    if (required && !cwd)\n      throw new Error(\"Manifest class require a project path\");\n\n    this.images   = {};\n    this.systems  = {};\n    this.bins     = {};\n    this._default = null;\n    this.file     = file || Manifest.find_manifest(cwd);\n\n    if (required && !this.exist)\n      throw new ManifestRequiredError(cwd);\n\n    this.meta    = new Meta(this);\n  }\n\n  // Validate\n  validate(...args) {\n    return Validate.analyze(this, ...args);\n  }\n\n  parse() {\n    var content = fs.readFileSync(this.file);\n    var err = check(content, this.file);\n    if (err) {\n      throw new ManifestError(this.file, err);\n    } else {\n      try {\n        runInNewContext(content, Manifest.createDslContext(this), this.file);\n      } catch (e) {\n        if (!(e instanceof ManifestError)) {\n          var stack = e.stack.split('\\n');\n          var msg   = stack[0] + \"\\n\" + stack[1];\n          e = new ManifestError(this.file, msg);\n        }\n        throw e;\n      }\n    }\n    this.systemsInOrder();\n  }\n\n  static createDslContext(target, source, file) {\n    return _.reduce(ManifestDsl, (context, func, name) => {\n      if (_.isFunction(func))\n        context[name] = func.bind(target);\n      else\n        context[name] = func;\n      return context;\n    }, { });\n  }\n\n  addSystem(name, data) {\n    if (!(data instanceof System)) {\n      this._system_validate(name, data);\n      var image = data.image;\n      delete data.image;\n      data = new System(this, name, image, data);\n    }\n\n    this.systems[name] = data;\n    if (!this._default) this._default = name;\n\n    return this;\n  }\n\n  _system_validate(name, data) {\n    if (!name.match(/^[a-zA-Z0-9-]+$/)) {\n      var msg = t(\"manifest.system_name_invalid\", { system: name });\n      throw new ManifestError(this.file, msg);\n    }\n    if (_.isEmpty(data.image)) {\n      var msg = t(\"manifest.image_required\", { system: name });\n      throw new ManifestError(this.file, msg);\n    }\n    if (!_.isEmpty(data.balancer)) {\n      var msg = t(\"manifest.balancer_depreciation\", { system: name });\n      throw new ManifestError(this.file, msg);\n    }\n  }\n\n  system(name, isRequired = false) {\n    var sys = this.systems[name];\n\n    if (isRequired && !sys)\n      throw new SystemNotFoundError(this.file, name);\n\n    return sys;\n  }\n\n  getSystemsByName(names) {\n    var systems_name = this.systemsInOrder();\n\n    if (_.isString(names) && !_.isEmpty(names)) {\n      names = _.isArray(names) ? names : names.split(',');\n      _.each(names, (name) => this.system(name, true));\n      systems_name = _.intersection(systems_name, names);\n    }\n\n    return _.reduce(systems_name, (systems, name) => {\n      systems.push(this.system(name, true));\n      return systems;\n    }, []);\n  }\n\n  systemsInOrder(requireds = []) {\n    var edges = [];\n    _.each(this.systems, (system, name) => {\n      if (_.isEmpty(system.depends)) {\n        edges.push([\"__\", name]);\n      } else {\n        _.each(system.depends, (depend) => {\n          if (this.system(depend)) {\n            edges.push([depend, name]);\n          } else {\n            var msg = t(\"manifest.depends_not_declared\", {\n              system: name,\n              depend: depend,\n            })\n            throw new ManifestError(this.file, msg);\n          }\n        });\n      }\n    });\n\n    var result = tsort(edges);\n    if (result.error) {\n      var data = result.error.message.match(/^(.*?)\\s.*\\s(.*)$/);\n      var msg  = t(\"manifest.circular_depends\", {\n        system1: data[1], system2: data[2]\n      });\n      throw new ManifestError(this.file, msg);\n    }\n\n    var path = _.isEmpty(requireds) ? result.path : [];\n    if (_.isEmpty(path)) {\n      requireds = _.isArray(requireds) ? requireds : [requireds];\n      path = _.reduce(requireds, (path, node) => {\n        return this.__putNodesInPath(result.graph, path, node);\n      }, path);\n    }\n\n    return path.slice(1);\n  }\n\n  __putNodesInPath(graph, path, node_id) {\n    var node = _.find(graph, (node) => { return node.id == node_id });\n    if (!_.isEmpty(node)) {\n      path = _.reduce(node.parents, (path, parent) => {\n        return this.__putNodesInPath(graph, path, parent);\n      }, path);\n      if (!_.contains(path, node_id)) {\n        path.push(node_id);\n      }\n    } else {\n      throw new SystemNotFoundError(this.file, node_id);\n    }\n    return path;\n  }\n\n  // Meta forwarding\n  getMeta(...args) {\n    return this.meta.getOrSet(...args);\n  }\n\n  setMeta(...args) {\n    this.meta.set(...args);\n    return this;\n  }\n\n  cleanMeta(...args) {\n    return this.meta.clean(...args);\n  }\n\n  // Default system\n  set default(nameOrSystem) {\n    if (nameOrSystem instanceof System) {\n      nameOrSystem = nameOrSystem.name;\n    }\n\n    if (!(this.systems[nameOrSystem] instanceof System)) {\n      var msg = t('manifest.invalid_default', { system: nameOrSystem });\n      throw new ManifestError(this.file, msg);\n    }\n\n    this._default = nameOrSystem;\n  }\n\n  get systemDefault() {\n    return this.system(this._default);\n  }\n\n  // Getters\n  get manifestPath() {\n    return this.cwd;\n  }\n\n  get manifestDirName() {\n    return path.basename(this.manifestPath);\n  }\n\n  get file() {\n    return this.__file;\n  }\n\n  get exist() {\n    return fs.existsSync(this.file);\n  }\n\n  set file(value) {\n    this.cwd = path.dirname(value);\n    this.__file = value;\n    if (this.exist) {\n      this.parse();\n    }\n  }\n\n  get file_relative() {\n    return path.relative(this.manifestPath, this.file);\n  }\n\n  // TODO: make more fast\n  get namespace() {\n    var def = Utils.calculateHash(this.file).slice(0, 10);\n    return this.meta.getOrSet('namespace', def);\n  }\n\n  get cache_dir() {\n    return path.join(\n      this.cwd,\n      config('azk_dir'),\n      this.file_relative\n    )\n  }\n\n  static find_manifest(target) {\n    var dir = Utils.cd(target, function() {\n      return parent(file_name);\n    });\n    return dir ? path.join(dir, file_name) : null;\n  }\n\n  static makeFake(cwd, image) {\n    var file = path.join(cwd, file_name);\n    var manifest = new Fake(null, file);\n\n    return manifest.addSystem(\"--tmp--\", {\n      image: image,\n      workdir: \"/azk/#{manifest.dir}\",\n      mounts: {\n        \"/azk/#{manifest.dir}\": \"#{manifest.path}\"\n      }\n    });\n  }\n}\n\nclass Fake extends Manifest {\n  constructor(...args) {\n    super(...args);\n    this.meta.cache = {\n      values: {},\n      clean: function() {\n        this.values = {};\n      },\n      keyCalc: function(key) {\n        return Utils.calculateHash(JSON.stringify(key));\n      },\n      getSync: function(key) {\n        return this.values[this.keyCalc(key)];\n      },\n      putSync: function(key, value) {\n        this.values[this.keyCalc(key)] = value;\n      }\n    }\n  }\n  parse() {}\n}\n\nexport { file_name, System };\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","\n            for (var $__placeholder__0 = [], $__placeholder__1 = $__placeholder__2;\n                 $__placeholder__3 < arguments.length; $__placeholder__4++)\n              $__placeholder__5[$__placeholder__6 - $__placeholder__7] = arguments[$__placeholder__8];","$traceurRuntime.spread($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2)","var $__placeholder__0 = $__placeholder__1","\n            for (var $__placeholder__0 = [], $__placeholder__1 = 0;\n                 $__placeholder__2 < arguments.length; $__placeholder__3++)\n              $__placeholder__4[$__placeholder__5] = arguments[$__placeholder__6];","$traceurRuntime.toObject($__placeholder__0)","$traceurRuntime.superCall($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                   $__placeholder__3)","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}