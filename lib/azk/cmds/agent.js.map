{"version":3,"file":"agent.js","sources":["../../../src/cmds/agent.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"AAAA;ACAI,CAAJ,EAAI,CAAA,YAAY,mBAAoB,CAAC;UCArC,CAAA,OAAO,CFA0C,KAAK,CEA5B;;;;;;UAA1B,CAAA,OAAO,CFC0B,iBAAiB,CEDxB;;;sBAA1B,CAAA,OAAO,CFE0B,kBAAkB,CEFzB;QAA1B,CAAA,OAAO,CFGe,cAAc,CEHV;AFKtB,CAAJ,EAAI,CAAA,GAAG,EAAG,CAAA,OAAO,CAAC,KAAK,CAAC,CAAC;AGLrB,CAAJ,EAAI,MHOJ,SAAM,IAAG;AIPT,CAAA,gBAAe,iBAAiB,CAAC,IAAI,CACrB,eAA2B,CAAE,UAAS,CAAC,CAAA;CDDd,AHyBxC,CGzBwC;AEArC,CAAJ,EAAI,WAAqC,CAAA;ACAzC,CAAA,AAAC,eAAe,YAAY,CAAC,ONQ3B,MAAM,CAAN,UAAO,IAAI;AACL,CAAJ,MAAI,CAAA,MAAM,EAAK,CAAA,OAAO,CAAC,kBAAkB,CAAC,OAAO,CAAC;AAC9C,CAAJ,MAAI,CAAA,QAAQ,EAAG,CAAA,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;CAE7C,SAAO,CAAA,KAAK,CAAC,IAAI,WAAa;;;COZlC,WAAO,CCAP,eAAe,cAAc,ADAL,CEAxB,SAAS,IAAI,CAAE;CACT,cAAO,IAAI;;;ACDjB,CAAA,iBAAI,MAAM,EAAG,CAAA,CVaH,IAAI,CAAC,WAAW,CAAC,GAAI,CAAA,IAAI,OAAO,GAAI,QAAO,CUbrB,QAAwC,CAAC;CACjE,mBAAK;;sBVaQ,CAAA,IAAI,OAAO,SAAS,GAAG;;;;;CWd5C,mBXec,CAAA,MAAM,OAAO,CAAC;AAAE,CAAA,qBAAM,CAAE,SAAQ;AAAE,CAAA,mBAAI,aAAQ,GAAE,CAAA;eAAE,CAAC,CWfzC;;ACAxB,CAAA,iBAAI,WAAW,EAAE,CAAA;;;;uBZkBG,CAAA,MAAM,CAAC,IAAI,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;;;;AalBhE,CAAA,iBAAI,YAAY,EbmBH,CAAA,OAAO,KAAK,WAAE,MAAM,CAAK;CAC9B,mBAAI,IAAI,OAAO,GAAI,SAAQ;CAAE,uBAAO,OAAM,CAAC;AAC3C,CAD2C,qBACpC,CAAA,CAAC,MAAM,MAAM,CAAC,EAAG,EAAC,EAAG,EAAC,CAAC;eAC/B,EatB6B,AbsB5B,CatB4B;;;;CCApC,mBAAO,CAAA,IAAI,IAAI,EAAE,CAAA;;CLCmB,MAC/B,CFAO,KAAI,CAAC,CAAC;MPqBZ,CAAC;GACJ,MAjBe,QAAO,CMNgC;CN0BlD,OAAS,KAAI,CAAC,GAAG,CAAE;AACpB,CAAJ,IAAI,CAAA,GAAG,EAAG,CAAA,CAAC,GAAI,IAAG,CAAC,gBAAgB,CAAE,IAAG,CAAC,CAAC,WAC7B,CAAC,QAAQ,CAAE,EAAE,OAAO,CAAE,EAAC,OAAO,CAAE,SAAQ,CAAE,OAAM,CAAC,CAAE,CAAC,UACrD,CAAC,CAAC,UAAU,CAAE,KAAI,CAAC,CAAE,EAAE,OAAO,CAAE,KAAI,CAAE,CAAC,CAAC;CAEpD,KAAI,MAAM,CAAC,mBAAmB,CAAC,CAAE;AAC/B,CAAA,MAAG,UAAU,CAAC,CAAC,aAAa,CAAE,KAAI,CAAC,CAAE,EAAE,OAAO,CAAE,KAAI,CAAE,CAAC,CAAC;GACzD;CAAA,AACF;AenCD,CfmCC,KenCK,QAAQ;CCAd,WAAwB;CAAE,eAAyB;GAAE;ACArD,CAAA,WAAU,CAAE,KAAI;CAAA,AFAkB,CAAC;CfoCnC","sourcesContent":["import { _, fs, config, async, set_config } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { AGENT_CODE_ERROR } from 'azk/utils/errors';\nimport { VM  }   from 'azk/agent/vm';\n\nvar net = require('net');\n\nclass Cmd extends Command {\n  action(opts) {\n    var Client   = require('azk/agent/client').Client;\n    var progress = Helpers.vmStartProgress(this);\n\n    return async(this, function* () {\n      if (opts['reload-vm'] && opts.action == \"start\") {\n        var cmd_vm = this.parent.commands.vm;\n        yield cmd_vm.action({ action: 'remove', fail: () => {} });\n      }\n\n      var promise = Client[opts.action](opts).progress(progress);\n      return promise.then((result) => {\n        if (opts.action != \"status\") return result;\n        return (result.agent) ? 0 : 1;\n      });\n    });\n  }\n}\n\nexport function init(cli) {\n  var cli = (new Cmd('agent {action}', cli))\n    .setOptions('action', { options: ['start', 'status', 'stop'] })\n    .addOption(['--daemon', '-d'], { default: true });\n\n  if (config('agent:requires_vm')) {\n    cli.addOption(['--reload-vm', '-d'], { default: true });\n  }\n}\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","return $__placeholder__0","$ctx.maybeThrow()","$ctx.returnValue = $__placeholder__0","return $ctx.end()","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}