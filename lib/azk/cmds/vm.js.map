{"version":3,"file":"vm.js","sources":["../../../src/cmds/vm.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { Q, _, config, async, t } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { Server } from 'azk/agent/server';\nimport { VM } from 'azk/agent/vm';\nimport { net } from 'azk/utils';\n\nclass RequiredError extends Error {\n  constructor(key) {\n    this.key = key\n  }\n}\n\nclass VmCmd extends Command {\n  require_installed(vm_info) {\n    if (!vm_info.installed) {\n      throw new RequiredError(\"commands.vm.not_installed\");\n    }\n  }\n\n  require_running(vm_info) {\n    this.require_installed(vm_info);\n    if (!vm_info.running) {\n      throw new RequiredError(\"commands.vm.not_runnig\");\n    }\n  }\n\n  action(opts) {\n    if (!config('agent:requires_vm')) {\n      this.fail('commands.vm.not_requires');\n      return 1;\n    }\n\n    return async(this, function* () {\n      var action  = opts.action;\n      var vm_name = config(\"agent:vm:name\");\n      var vm_info = yield VM.info(vm_name);\n\n      var promise = this[`action_${action}`](vm_info);\n      promise = promise.progress(Helpers.vmStartProgress(this));\n\n      return promise.fail(opts.fail || ((error) => {\n        if (error instanceof RequiredError) {\n          this.fail(error.key);\n          return 1;\n        }\n        throw error;\n      }));\n    });\n  }\n\n  action_start(vm_info) {\n    return async(this, function* () {\n      if (vm_info.running) {\n        this.fail(\"commands.vm.already_running\");\n        return 1;\n      }\n      this.require_installed(vm_info);\n      yield Server.installVM(true, false);\n    });\n  }\n\n  action_stop(vm_info) {\n    return async(this, function* () {\n      this.require_running(vm_info);\n      yield VM.stop(vm_info.name);\n    });\n  }\n\n  action_status(vm_info) {\n    return async(this, function* () {\n      this.require_running(vm_info);\n      this.ok(\"commands.vm.running\");\n    });\n  }\n\n  action_installed(vm_info) {\n    return async(this, function* () {\n      this.require_installed(vm_info);\n      this.ok(\"commands.vm.already\");\n    });\n  }\n\n  action_install(vm_info) {\n    return async(this, function* () {\n      if (vm_info.installed) {\n        throw new RequiredError(\"commands.vm.already\");\n      }\n      yield Server.installVM(false, false);\n    });\n  }\n\n  action_remove(vm_info) {\n    return async(this, function* () {\n      this.require_installed(vm_info);\n      if (vm_info.running) {\n        yield VM.stop(vm_info.name);\n      }\n      yield VM.remove(vm_info.name);\n    });\n  }\n\n  action_reload(vm_info) {\n    return async(this, function* () {\n      this.require_installed(vm_info);\n\n      // Remove and install\n      yield this.action_remove(vm_info);\n      yield this.action_install({ installed: false });\n\n      if (vm_info.running) {\n        yield this.action_start({ installed: true, name: vm_info.name });\n      }\n    });\n  }\n}\n\nexport function init(cli) {\n  if (config('agent:requires_vm')) {\n    (new VmCmd('vm {action}', cli))\n      .setOptions('action', { options: ['install', 'installed', 'start', 'status', 'stop', 'remove', 'reload'] });\n  }\n}\n\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.sent","$ctx.returnValue = $__placeholder__0","return $ctx.end()","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$ctx.maybeThrow()","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}