{"version":3,"file":"index.js","sources":["../../../src/utils/index.js","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/6"],"names":[],"mappings":"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","sourcesContent":["import { join, basename, dirname } from 'path';\nimport { i18n } from 'azk/utils/i18n';\n\nvar crypto = require('crypto');\nvar Q    = require('q');\nvar _    = require('lodash');\nvar fs   = require('fs');\nvar zlib = require('zlib');\n\nvar Utils = {\n  get default() { return Utils },\n  get i18n()    { return i18n; },\n  get Q()       { return Q; },\n  get _()       { return _; },\n  get net()     { return require('azk/utils/net').default },\n  get docker()  { return require('azk/utils/docker').default },\n\n  envs(key, defaultValue = null) {\n    return process.env[key] || defaultValue;\n  },\n\n  cd(target, func) {\n    var result, old = process.cwd();\n\n    process.chdir(target);\n    result = func();\n    process.chdir(old);\n\n    return result;\n  },\n\n  resolve(...path) {\n    path = join(...path);\n\n    // Remove file from path\n    var file = \"\";\n    var stat = fs.statSync(path);\n    if (stat.isFile()) {\n      file = basename(path);\n      path = dirname(path);\n    }\n\n    return Utils.cd(path, function() {\n      return join(process.cwd(), file);\n    });\n  },\n\n  defer(func) {\n    return Q.Promise((resolve, reject, notify) => {\n      process.nextTick(() => {\n        try {\n          resolve = _.extend(resolve, { resolve, reject, notify });\n          var result = func(resolve, reject, notify);\n        } catch (e) {\n          return reject(e);\n        }\n\n        if (Q.isPromise(result)) {\n          result.progress(notify).then(resolve, reject);\n        } else if (typeof(result) != \"undefined\") {\n          resolve(result);\n        }\n      });\n    });\n  },\n\n  async(obj, func, ...args) {\n    return Utils.defer((_resolve, _reject, notify) => {\n      if (typeof obj == \"function\")\n        [func, obj] = [obj, null];\n\n      if (typeof obj == \"object\") {\n        func = func.bind(obj);\n      }\n\n      return Q.async(func)(...args, notify);\n    });\n  },\n\n  qify(klass) {\n    if (_.isString(klass))\n      klass = require(klass);\n\n    var newClass = function(...args) {\n      klass.call(this, ...args);\n    }\n\n    newClass.prototype = Object.create(klass.prototype);\n\n    _.each(_.methods(klass.prototype), (method) => {\n      var original = klass.prototype[method];\n      newClass.prototype[method] = function(...args) {\n        return Q.nbind(original, this)(...args);\n      };\n    });\n\n    return newClass;\n  },\n\n  qifyModule(mod) {\n    var newMod = _.clone(mod);\n\n    _.each(_.methods(mod), (method) => {\n      var original = mod[method];\n      newMod[method] = function(...args) {\n        return Q.nbind(original, this)(...args);\n      };\n    });\n\n    return newMod;\n  },\n\n  unzip(origin, target) {\n    return Utils.defer((done) => {\n      try {\n        var input  = fs.createReadStream(origin);\n        var output = fs.createWriteStream(target);\n\n        output.on(\"close\", () => done.resolve());\n        input.pipe(zlib.createGunzip()).pipe(output);\n      } catch (err) {\n        done.reject(err);\n      }\n    });\n  },\n\n  deepExtend(origin, target) {\n    target = _.clone(target);\n\n    _.each(origin, (value, key) => {\n      if (!_.has(target, key) || typeof(target[key]) != typeof(value)) {\n        target[key] = value;\n      } else if (_.isObject(target[key]) && _.isObject(value)) {\n        target[key] = Utils.deepExtend(value, target[key]);\n      }\n    });\n\n    return target;\n  },\n\n  calculateHash(string) {\n    var shasum = crypto.createHash('sha1');\n    shasum.update(string);\n    return shasum.digest('hex');\n  },\n\n  escapeRegExp(value) {\n    return (value || \"\").replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n  },\n\n  template(template, data) {\n    var options = { interpolate: /(?:(?:[#|$]{|<%)[=|-]?)([\\s\\S]+?)(?:}|%>)/g };\n    return _.template(template, data, options);\n  },\n};\n\nmodule.exports = Utils;\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","\n            for (var $__placeholder__0 = [], $__placeholder__1 = 0;\n                 $__placeholder__2 < arguments.length; $__placeholder__3++)\n              $__placeholder__4[$__placeholder__5] = arguments[$__placeholder__6];","$traceurRuntime.toObject($__placeholder__0)","\n            for (var $__placeholder__0 = [], $__placeholder__1 = $__placeholder__2;\n                 $__placeholder__3 < arguments.length; $__placeholder__4++)\n              $__placeholder__5[$__placeholder__6 - $__placeholder__7] = arguments[$__placeholder__8];","$traceurRuntime.spread($__placeholder__0)"]}