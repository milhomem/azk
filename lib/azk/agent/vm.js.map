{"version":3,"file":"vm.js","sources":["../../../src/agent/vm.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { _, Q, config, defer, async, t, log } from 'azk';\nimport Utils from 'azk/utils';\nimport { Tools } from 'azk/agent/tools';\nimport { SSH } from 'azk/agent/ssh';\n\nvar vbm  = require('vboxmanage');\nvar qfs  = require('q-io/fs');\nvar os   = require('os');\n\nvar machine  = Utils.qifyModule(vbm.machine );\nvar instance = Utils.qifyModule(vbm.instance);\nvar hostonly = Utils.qifyModule(vbm.hostonly);\nvar dhcp     = Utils.qifyModule(vbm.dhcp    );\nvar _exec    = Q.nbind(vbm.command.exec, vbm.command);\n\nfunction exec(...args) {\n  return _exec(...args).then((result) => {\n    if (result[0] != 0) {\n      result[1] = \"command: \" + args.join(' ') + \"\\n\\n\" + result[1];\n      throw new Error(result[1]);\n    }\n    return result[1];\n  });\n}\n\nfunction modifyvm(name, ...options) {\n  return exec(\"modifyvm\", name, ...options);\n}\n\nvar hdds = {\n  list() {\n    return exec(\"list\", \"hdds\").then((output) => {\n      return vbm.parse.linebreak_list(output);\n    });\n  },\n\n  close(file, remove) {\n    var args = [\"closemedium\", \"disk\", file];\n    if (remove) { args.push(\"--delete\"); }\n    return exec.apply(null, args);\n  },\n\n  clonehd(origin, target) {\n    var self = this;\n    return exec(\"clonehd\", origin, target)\n      .then(hdds.list)\n      .then((hdds) => {\n        var closes = [];\n        _.each(hdds, (hdd) => {\n          if (_.contains([origin, target], hdd.Location)) {\n            closes.push(self.close(hdd.Location), hdd.Location == origin);\n          }\n        });\n        return Q.all(closes);\n      });\n  },\n}\n\nfunction config_nat_interface(name, replace = false) {\n  return async(function* () {\n    var ssh_port  = yield Utils.net.getPort();\n    var ssh_natpf = [\"--natpf2\", \"ssh,tcp,127.0.0.1,\" + ssh_port + \",,22\"]\n\n    if (replace) {\n      // Remove and add\n      yield modifyvm(name, [\"--natpf2\", \"delete\", \"ssh\"]);\n      yield modifyvm(name, ssh_natpf);\n    } else {\n      yield modifyvm(name, [\n        \"--nic2\", \"nat\",\n        \"--nictype2\", \"virtio\",\n        \"--cableconnected2\", \"on\",\n        ...ssh_natpf\n      ]);\n    }\n  });\n}\n\nfunction config_dhcp(net, getway, net_mask, ip) {\n  return async(function* () {\n    var lower_ip = ip;\n    var upper_ip = ip;\n    yield dhcp.ensure_hostonly_server(net, getway, net_mask, lower_ip, upper_ip);\n    yield dhcp.enable_hostonly_server(net);\n  });\n}\n\nfunction config_net_interfaces(name, ip) {\n  var nat_name = \"azk-nat-network\";\n\n  return async(function* () {\n    var result = yield exec(\"hostonlyif\", \"create\");\n    var inter  = result.match(/Interface '(.*)?'/)[1];\n\n    yield modifyvm(name, [\n      \"--nic1\", \"hostonly\",\n      \"--nictype1\", \"virtio\",\n      \"--cableconnected1\", \"on\",\n      \"--hostonlyadapter1\", inter\n    ]);\n\n    // Configure dhcp server\n    var getway   = Utils.net.calculateGatewayIp(ip);\n    var net_mask = \"255.255.255.0\";\n\n    // nat interfance\n    yield config_nat_interface(name);\n    yield hostonly.configure_if(inter, getway, net_mask);\n    yield config_dhcp(inter, getway, net_mask, ip);\n  });\n}\n\nfunction config_disks(name, boot, data) {\n  var storage_opts = [\n    \"storagectl\"   , name  ,\n    \"--name\"       , \"SATA\",\n    \"--add\"        , \"sata\",\n    \"--hostiocache\", \"on\"  ,\n  ];\n\n  var storage_boot = [\n    \"storageattach\", name  ,\n    \"--storagectl\" , \"SATA\",\n    \"--port\"       , \"0\"   ,\n    \"--device\"     , \"0\"   ,\n    \"--type\"       , \"dvddrive\",\n    \"--medium\"     , boot  ,\n  ];\n\n  var storage_data = [\n    \"storageattach\", name  ,\n    \"--storagectl\" , \"SATA\",\n    \"--port\"       , \"1\"   ,\n    \"--device\"     , \"0\"   ,\n    \"--type\"       , \"hdd\" ,\n    \"--medium\"     , data  ,\n  ];\n\n  return async(function* () {\n    if (!(yield qfs.exists(data))) {\n      var file = data + \".tmp\";\n      yield Utils.unzip(config(\"agent:vm:blank_disk\"), file);\n      yield hdds.clonehd(file, data);\n    }\n\n    yield exec.apply(null, storage_opts);\n    yield exec.apply(null, storage_boot);\n    yield exec.apply(null, storage_data);\n  });\n}\n\nfunction acpipowerbutton(name) {\n  return exec('controlvm', name, 'acpipowerbutton');\n}\n\nvar vm = {\n  info(vm_name) {\n    return machine.info(vm_name).then((info) => {\n      if (info['Forwarding(0)']) {\n        var port = info['Forwarding(0)'].replace(/ssh,tcp,127.0.0.1,(.*),,22/, '$1');\n        if (port) {\n          info.ssh_port = port;\n        }\n      }\n      return _.merge(info, { installed: true, running: info.VMState == \"running\" });;\n    }, (err) => {\n      if (err.message.match(/cannot show vm info/))\n        return { installed: false, running: false };\n      throw err;\n    });\n  },\n\n  init(opts) {\n    return Tools.async_status(\"vm\", this, function* (status_change) {\n      var name = opts.name;\n      if (yield this.isInstalled(name))\n        return false;\n\n      status_change(\"installing\");\n      yield exec(\"createvm\", \"--name\", name, \"--register\");\n\n      var cmd = [\n        \"--ostype\", \"Linux26_64\",\n        \"--cpus\", config(\"agent:vm:cpus\"),\n        \"--memory\", config(\"agent:vm:memory\"),\n        \"--vram\", \"9\",\n        \"--rtcuseutc\", \"on\",\n        \"--acpi\", \"on\",\n        \"--ioapic\", \"on\",\n        \"--hpet\", \"on\",\n        \"--hwvirtex\", \"on\",\n        \"--vtxvpid\", \"on\",\n        \"--largepages\", \"on\",\n        \"--nestedpaging\", \"on\",\n        \"--firmware\", \"bios\",\n        \"--bioslogofadein\", \"off\",\n        \"--bioslogofadeout\", \"off\",\n        \"--bioslogodisplaytime\", \"0\",\n        \"--biosbootmenu\", \"disabled\",\n        \"--boot1\", \"dvd\",\n      ]\n\n      var usage = yield Q.nfcall(vbm.command.exec, \"modifyvm\");\n      if (usage.join(\"\\n\").match(/--vtxux/)) {\n        cmd.push('--vtxux', 'on');\n      }\n\n      yield modifyvm(name, cmd);\n      yield config_net_interfaces(name, opts.ip);\n      yield config_disks(name, opts.boot, opts.data);\n\n      status_change(\"installed\");\n      return yield this.info(name);\n    });\n  },\n\n  isInstalled(vm_name) {\n    return this.info(vm_name).then((status) => {\n      return status.installed;\n    })\n  },\n\n  isRunnig(vm_name) {\n    return this.info(vm_name).then((status) => {\n      return status.running;\n    })\n  },\n\n  // TODO: Move install to start\n  start(vm_name) {\n    log.debug(\"call to start vm %s\", vm_name);\n    return Tools.async_status(\"vm\", this, function* (status_change) {\n      var info = yield vm.info(vm_name);\n\n      if (info.installed && !(info.running)) {\n        status_change(\"starting\");\n        // Reconfigures the interface nat all times\n        yield config_nat_interface(vm_name, true);\n        return instance.start(vm_name).then(() => {\n          status_change(\"started\");\n          return true\n        });\n      }\n      return false;\n    });\n  },\n\n  stop(vm_name, force = false) {\n    log.debug(\"call to stop vm %s\", vm_name);\n\n    return Tools.async_status(\"vm\", this, function* (status_change) {\n      var info = yield vm.info(vm_name);\n      if (info.running) {\n        status_change(\"stoping\");\n\n        if (force) {\n          yield instance.stop(vm_name);\n        } else {\n          yield acpipowerbutton(vm_name);\n        }\n\n        // Wait for shutdown\n        while(true) {\n          info = yield this.info(vm_name);\n          if (!info.running) break;\n        }\n\n        status_change(\"stoped\");\n        return true;\n      }\n      return false;\n    });\n  },\n\n  remove(vm_name) {\n    return Tools.async_status(\"vm\", this, function* (status_change) {\n      var info = yield vm.info(vm_name);\n\n      if (info.name == vm_name) {\n        var fail = (error) => {\n          status_change(\"error\", error.stack || error);\n        }\n\n        status_change(\"removing\");\n\n        // Removing disk\n        if (typeof(info['SATA-1-0']) != 'undefined') {\n          yield exec(\"storagectl\", vm_name, \"--name\", \"SATA\", \"--remove\").fail(fail);\n          yield exec(\"closemedium\", \"disk\", info['SATA-1-0']).fail(fail);\n        }\n\n        // Remove vm\n        yield machine.remove(vm_name).fail(fail);\n\n        // Remove networking interface\n        if (info.nic1 != null) {\n          yield dhcp.remove_hostonly_server(info.hostonlyadapter1).fail(fail);\n          yield hostonly.remove_if(info.hostonlyadapter1).fail(fail);\n        }\n\n        status_change(\"removed\");\n      }\n    });\n  },\n\n  make_ssh(vm_name) {\n    return async(this, function* () {\n      var info = yield this.info(vm_name);\n      if (info.running) {\n        return new SSH('127.0.0.1', info.ssh_port);\n      } else {\n        throw new Error(\"vm is not running\");\n      }\n    });\n  },\n\n  ssh(name, cmd, wait = false) {\n    return this.make_ssh(name).then((ssh) => { return ssh.exec(cmd, wait) });\n  },\n\n  copyFile(name, origin, target) {\n    return this.make_ssh(name).then((ssh) => { return ssh.putFile(origin, target) });\n  }\n}\n\nexport { vm as VM };\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","\n            for (var $__placeholder__0 = [], $__placeholder__1 = 0;\n                 $__placeholder__2 < arguments.length; $__placeholder__3++)\n              $__placeholder__4[$__placeholder__5] = arguments[$__placeholder__6];","$traceurRuntime.toObject($__placeholder__0)","\n            for (var $__placeholder__0 = [], $__placeholder__1 = $__placeholder__2;\n                 $__placeholder__3 < arguments.length; $__placeholder__4++)\n              $__placeholder__5[$__placeholder__6 - $__placeholder__7] = arguments[$__placeholder__8];","$traceurRuntime.spread($__placeholder__0)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.sent","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$ctx.maybeThrow()","return $ctx.end()","$ctx.returnValue = $__placeholder__0","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}